package {{.PackageName}}

import (
    "base/app/models"
    "base/core/module"

    "gorm.io/gorm"
)

func init() {
    // Self-register the module for auto-discovery
    module.RegisterAppModule("{{.PackageName}}", func(deps module.Dependencies) module.Module {
        mod := &Module{
            DB: deps.DB,
        }
        
        // Setup service and controller
        service := New{{.Service}}(deps.DB, deps.Emitter, deps.Storage, deps.Logger)
        controller := New{{.Controller}}(service, deps.Storage)
        
        // Register routes
        controller.Routes(deps.Router)
        
        return mod
    })
}

type Module struct {
    module.DefaultModule
    DB *gorm.DB
}

func New{{.Model}}Module(db *gorm.DB) *Module {
    return &Module{
        DB: db,
    }
}

func (m *Module) Init() error {
    return nil
}

func (m *Module) Migrate() error {
    return m.DB.AutoMigrate(&models.{{.Model}}{})
}

func (m *Module) GetModels() []any {
    return []any{
        &models.{{.Model}}{},
    }
}
